<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>
    Pandas dataset analysis example // Just my blog
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="generator" content="Hugo 0.19" />

  <meta property="og:title" content="Pandas dataset analysis example" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="http://iryndin.net/post/pandas-dataset-analysis-example/" />


  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/base-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  
  
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/grids-responsive-min.css">
  
  

  <link rel="stylesheet" href="http://iryndin.net/css/redlounge.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//fonts.googleapis.com/css?family=Raleway:400,200,100,700,300,500,600,800' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Just my blog" />

    
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/styles/tomorrow-night-bright.min.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  

  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', "UA-55566999-1", 'auto');
  ga('send', 'pageview');
</script>

</head>

<body>
	

	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

	

    
    

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="http://iryndin.net">Home</a></li>
        
      </ul>
    </nav>

    

  </div>
</div>

	
	

    <div class="content pure-u-1 pure-u-md-3-4">
		<a name="top"></a>
		

		
			
		    <div id="toc" class="pure-u-1 pure-u-md-1-4">
				<small class="toc-label">Contents</small>
		   	 	<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#task-0-import-dataset">Task 0. Import dataset</a></li>
<li><a href="#task-1-count-males-and-females">Task 1. Count males and females</a></li>
<li><a href="#task-2-calculate-who-drinks-alcohol-less-in-average-males-or-females">Task 2. Calculate who drinks alcohol less (in average): males or females</a></li>
<li><a href="#task-3-calculate-how-many-times-greater-percentage-of-smoking-males-is-compared-to-that-of-females">Task 3. Calculate how many times greater percentage of smoking males is compared to that of females?</a></li>
<li><a href="#task-4-in-what-units-age-is-measured-here-what-is-difference-in-months-between-median-age-of-smokers-and-non-smokers">Task 4. In what units age is measured here? What is difference (in months) between median age of smokers and non-smokers?</a></li>
<li><a href="#task-5-create-2-special-datasets-from-initial-one-and-calculate-in-how-many-times-portion-of-sick-people-in-one-dataset-is-greater-than-that-of-another-dataset">Task 5. Create 2 special datasets from initial one and calculate in how many times portion of sick people in one dataset is greater than that of another dataset?</a></li>
<li><a href="#task-6-assess-some-bmi-statements">Task 6. Assess some BMI statements</a></li>
<li><a href="#task-7-clean-up-data">Task 7. Clean up data.</a></li>
<li><a href="#links">Links</a></li>
</ul></li>
</ul>
</nav>
		    </div>
		    
	    
  		<section class="post">
            <h1 class="post-title">
              <a href="/post/pandas-dataset-analysis-example/">Pandas dataset analysis example</a>
            </h1>
            <h3 class="post-subtitle">
            	
            </h3>
            
            	<span class="post-date">
                	<span class="post-date-day"><sup>11</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Feb</span> <span class="post-date-year">2018</span>
            	</span>
            	
            
            	
            

			
			

			

			

            <p>Let&rsquo;s show how can we use <a href="https://pandas.pydata.org/">Pandas</a> for data analysis.
Let&rsquo;s take a <a href="https://github.com/iryndin/Machine-Learning/blob/master/data/01-cardio/cardio.csv">cardio dataset</a>
from here: <a href="https://github.com/iryndin/Machine-Learning/tree/master/data/01-cardio">https://github.com/iryndin/Machine-Learning/tree/master/data/01-cardio</a></p>

<p></p>

<h2 id="task-0-import-dataset">Task 0. Import dataset</h2>

<p>First, import necessary libs and read the data:</p>

<pre><code>import pandas as pd
import numpy as np

df = pd.read_csv('cardio.csv', sep=';', index_col='id')

</code></pre>

<p>Now we have DataFrame (<code>df</code>), which is one of main entities Pandas work with.</p>

<p>This dataset contains following fields:</p>

<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>id</td>
<td>Patient ID</td>
</tr>

<tr>
<td>age</td>
<td>Age in days</td>
</tr>

<tr>
<td>gender</td>
<td>Male or female</td>
</tr>

<tr>
<td>age</td>
<td>Age in days</td>
</tr>

<tr>
<td>height</td>
<td>Height in cm</td>
</tr>

<tr>
<td>weight</td>
<td>Weight in kg</td>
</tr>

<tr>
<td>ap_hi</td>
<td>Arterial Pressure (high)</td>
</tr>

<tr>
<td>ap_lo</td>
<td>Arterial Pressure (low)</td>
</tr>

<tr>
<td>cholesterol</td>
<td>?</td>
</tr>

<tr>
<td>gluc</td>
<td>?</td>
</tr>

<tr>
<td>smoke</td>
<td>Smoking or not</td>
</tr>

<tr>
<td>alco</td>
<td>Drinks alco or not</td>
</tr>

<tr>
<td>active</td>
<td>?</td>
</tr>

<tr>
<td>cardio</td>
<td>Has cardio probem or not</td>
</tr>
</tbody>
</table>

<h2 id="task-1-count-males-and-females">Task 1. Count males and females</h2>

<p>Let&rsquo;s count total number of males and females. OK, we have a column <code>gender</code> which contains values <code>1</code> and <code>2</code>.
But which of them is male, and which is female? It is not clear.</p>

<p>We can determine this using reasonable assumption that males are in average higher than females. So, we need to filter those rows
which have <code>gender=1</code> and calculate mean height for them. Then we should calculate mean height value for rows with <code>gender=2</code>.
Then we should check which of values if bigger, and hence assume that those are for males. Let&rsquo;s do this:</p>

<pre><code>&gt;&gt;&gt; df[df['gender'] == 1]['height'].mean()
161.35561168460356
&gt;&gt;&gt; df[df['gender'] == 2]['height'].mean()
169.94789538210054
</code></pre>

<p>Here we see that for rows with <code>gender=2</code> mean height is greater that for rows with <code>gender=1</code>.
So we can conclude that <code>gender=2</code> is for males, while <code>gender=1</code> is for females. Let&rsquo;s create separate dataframes
bot for males and females:</p>

<pre><code>males = df[df['gender'] == 2]
females = df[df['gender'] == 1]
</code></pre>

<p>Now let&rsquo;s answer this task&rsquo;s question about number of males and females:</p>

<pre><code>&gt;&gt;&gt; males['age'].count()
24470
&gt;&gt;&gt; females['age'].count()
45530
</code></pre>

<p>So the answer to Task 1 is:</p>

<ul>
<li>24470 males</li>
<li>45530 females</li>
</ul>

<h2 id="task-2-calculate-who-drinks-alcohol-less-in-average-males-or-females">Task 2. Calculate who drinks alcohol less (in average): males or females</h2>

<p>Alcohol usage column is <code>alco</code> and it contains values <code>1</code> (in use) and <code>0</code> (not in use).
So we simply need to calculate a portion of alco drinkes for males and females and compare these values.</p>

<p>We can do it in two ways:</p>

<ul>
<li>filter by <code>alco</code> column value and calculate proportion</li>
<li>simply sum <code>alco</code> column values and divide by total number of males/females respectively.</li>
</ul>

<p>Let&rsquo;s do both. First one:</p>

<pre><code>&gt;&gt;&gt; males[males['alco']==1]['age'].count()/float(males['age'].count())
0.10637515324887617
&gt;&gt;&gt; females[females['alco']==1]['age'].count()/float(females['age'].count())
0.025499670546892159
</code></pre>

<p>Second approach:</p>

<pre><code>&gt;&gt;&gt; males['alco'].sum()/float(males['age'].count())
0.10637515324887617
&gt;&gt;&gt; females['alco'].sum()/float(females['age'].count())
0.025499670546892159
</code></pre>

<p>We see that portion of males drinking alco is 10.6%, while for females it is 2.5%.</p>

<p>So the answer to Task 2 is: females drink alco less.</p>

<h2 id="task-3-calculate-how-many-times-greater-percentage-of-smoking-males-is-compared-to-that-of-females">Task 3. Calculate how many times greater percentage of smoking males is compared to that of females?</h2>

<p>Let&rsquo;s calculate this:</p>

<pre><code>&gt;&gt;&gt; smoking_males_percentage = 100*males[males['smoke']==1]['age'].count()/float(males['age'].count())
&gt;&gt;&gt; smoking_females_percentage = 100*females[females['smoke']==1]['age'].count()/float(females['age'].count())
&gt;&gt;&gt; round(smoking_males_percentage/smoking_females_percentage)
12.0
</code></pre>

<p>Answer to Task 3 is: 12</p>

<h2 id="task-4-in-what-units-age-is-measured-here-what-is-difference-in-months-between-median-age-of-smokers-and-non-smokers">Task 4. In what units age is measured here? What is difference (in months) between median age of smokers and non-smokers?</h2>

<p>OK, let&rsquo;s look at age stats:</p>

<pre><code>&gt;&gt;&gt; df['age'].describe()
count    70000.000000
mean     19468.865814
std       2467.251667
min      10798.000000
25%      17664.000000
50%      19703.000000
75%      21327.000000
max      23713.000000
Name: age, dtype: float64
</code></pre>

<p>Ok, this is not similar to years, and even to months. May be in days? Let&rsquo;s check:</p>

<pre><code>&gt;&gt;&gt; df['age'].mean()/365
53.339358395303321
</code></pre>

<p>This is better. So age here is measured in days. Now let&rsquo;s calculate difference (in months) between median age of smokers and non-smokers:</p>

<pre><code>&gt;&gt;&gt; round((df[df['smoke']==0]['age'].median() - df[df['smoke']==1]['age'].median())/30)
20.0
</code></pre>

<p>The answer for Task 4 is:</p>

<ul>
<li>age here is in days</li>
<li>difference (in months) between median age of smokers and non-smokers: 20</li>
</ul>

<h2 id="task-5-create-2-special-datasets-from-initial-one-and-calculate-in-how-many-times-portion-of-sick-people-in-one-dataset-is-greater-than-that-of-another-dataset">Task 5. Create 2 special datasets from initial one and calculate in how many times portion of sick people in one dataset is greater than that of another dataset?</h2>

<p>Look at Wikipedia article about <a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%80%D0%B4%D0%B5%D1%87%D0%BD%D0%BE-%D1%81%D0%BE%D1%81%D1%83%D0%B4%D0%B8%D1%81%D1%82%D1%8B%D0%B9_%D1%80%D0%B8%D1%81%D0%BA">HeartScore</a>,
it gives clarification to following actions.</p>

<p>Do following:</p>

<ul>
<li>Create new column - <code>age_years</code>, round its values to integers. Then for this task take only smoking males aged 60 to 64 (inclusive).</li>
<li>In the dataset cholesterol level 1 is equal to 4 mmol/liter, 2 -&gt; 5-7 mmol/liter, 3 maps to 8 mmol/liter.</li>
<li>Create 2 datasets out of smoking males 60-64: <code>ap_hi &lt; 120</code> and <code>cholesterol=1</code> , another:  <code>160 &lt;= ap_hi &lt; 180</code> and <code>cholesterol=3</code></li>
<li>For given 2 datasets calculate in how many times portion of cardio-sick people in one dataset is greater than that of another dataset</li>
</ul>

<p>Do this:</p>

<pre><code>&gt;&gt;&gt; males['age_years'] = males.apply(lambda row: int(round(row.age/365.0)), axis=1)
&gt;&gt;&gt; smoking_males = males[(males['smoke']==1) &amp; (males['age_years']&gt;=60) &amp; (males['age_years']&lt;65)]
&gt;&gt;&gt; smoking_males_1 = smoking_males[(smoking_males['cholesterol']==1) &amp; (smoking_males['ap_hi']&lt;120)] 
&gt;&gt;&gt; smoking_males_2 = smoking_males[(smoking_males['cholesterol']==3) &amp; (smoking_males['ap_hi']&lt;180) &amp; (smoking_males['ap_hi']&gt;=160)] 
&gt;&gt;&gt; cardio_percentage_1 = 100*smoking_males_1[smoking_males_1['cardio']==1]['age'].count()/float(smoking_males_1['age'].count())
&gt;&gt;&gt; cardio_percentage_2 = 100*smoking_males_2[smoking_males_2['cardio']==1]['age'].count()/float(smoking_males_2['age'].count())
&gt;&gt;&gt; round(cardio_percentage_2/cardio_percentage_1)
3
</code></pre>

<p>Answer to Task 5: 3</p>

<h2 id="task-6-assess-some-bmi-statements">Task 6. Assess some BMI statements</h2>

<p>BMI (Body Mass index) is calculated as weight in kg divided by square of height in meters. Normal BMI values are between 18.5 and 25.</p>

<p>Assess following statements (is it true of false):</p>

<ul>
<li>Median BMI is greater than its normal values</li>
<li>Females BMI is in average less than males BMI</li>
<li>Cardio-healthy persons have in average greater BMI than cardio-sick ones</li>
<li>For cardio-healthy non-alco males BMI values in average are closer to norm than for cardio-healthy non-alco females</li>
</ul>

<p>Solution:</p>

<pre><code>&gt;&gt;&gt; df['bmi'] = df.apply(lambda row: row.weight/((row.height**2)/10000.0), axis=1)
&gt;&gt;&gt; df['bmi'].median()
26.374068120774975
&gt;&gt;&gt; df[df['gender']==1]['bmi'].mean()
27.98758344183285
&gt;&gt;&gt; df[df['gender']==2]['bmi'].mean()
26.754442357289349
&gt;&gt;&gt; df[df['cardio']==0]['bmi'].mean()
26.548175206794504
&gt;&gt;&gt; df[df['cardio']==1]['bmi'].mean()
28.56606062701535
&gt;&gt;&gt; df[(df['cardio']==0) &amp; (df['alco']==0) &amp; (df['gender']==2)]['bmi'].mean()
25.872638075460163
&gt;&gt;&gt; df[(df['cardio']==0) &amp; (df['alco']==0) &amp; (df['gender']==1)]['bmi'].mean()
26.845406594131507
</code></pre>

<p>Answer to Task 6:</p>

<ul>
<li>Median BMI is greater than its normal values. TRUE. (Because <code>26.374068120774975 &gt; 25</code>)</li>
<li>Females BMI is in average less than males BMI. FALSE (Because <code>27.98758344183285 &gt; 26.754442357289349</code>)</li>
<li>Cardio-healthy persons have in average greater BMI than cardio-sick ones. FALSE. (Because <code>26.548175206794504 &lt; 28.56606062701535</code>)</li>
<li>For cardio-healthy non-alco males BMI values in average are closer to norm than for cardio-healthy non-alco females. TRUE. (Because <code>25.872638075460163</code> is closer to <code>25</code> than <code>26.845406594131507</code>)</li>
</ul>

<h2 id="task-7-clean-up-data">Task 7. Clean up data.</h2>

<p>Filter data according to the following (throw out rows matching following criteria):</p>

<ul>
<li><code>ap_lo &gt; ap_hi</code></li>
<li>height is less than 2.5 percentile or greater than 97.5 percentile</li>
<li>weight is less than 2.5 percentile or greater than 97.5 percentile</li>
</ul>

<p>How many percents of data was thrown out?</p>

<pre><code>&gt;&gt;&gt; dfclean = df[df['ap_lo'] &lt;= df['ap_hi']]
&gt;&gt;&gt; h025 = df['height'].quantile(0.025)
&gt;&gt;&gt; h975 = df['height'].quantile(0.975)
&gt;&gt;&gt; dfclean = dfclean[(dfclean['height'] &gt;= h025) &amp; (dfclean['height'] &lt;= h975)]
&gt;&gt;&gt; w025 = df['weight'].quantile(0.025)
&gt;&gt;&gt; w975 = df['weight'].quantile(0.975)
&gt;&gt;&gt; dfclean = dfclean[(dfclean['weight'] &gt;= w025) &amp; (dfclean['weight'] &lt;= w975)]
&gt;&gt;&gt; size = df['age'].count()
&gt;&gt;&gt; sizeclean = dfclean['age'].count()
&gt;&gt;&gt; round(100.0*(1 - sizeclean/float(size)))
10
</code></pre>

<p>Answer to Task 7: 10</p>

<h2 id="links">Links</h2>

<ul>
<li><a href="https://github.com/Yorko/mlcourse_open">ML Course Open</a></li>
<li><a href="https://habrahabr.ru/company/ods/blog/322626/">ML Course Open. Lecture 1</a></li>
<li><a href="http://nbviewer.jupyter.org/github/Yorko/mlcourse_open/blob/master/jupyter_russian/homeworks/hw1_session3_data_analysis_pandas.ipynb?flush_cache=true">ML Course Open. Hometask 1.</a></li>
<li><a href="https://www.dataquest.io/blog/pandas-cheat-sheet/">Pandas Cheat Sheet</a></li>
</ul>
	
			

			
				<div class="tags-list">
					<span class="dark-red">Tags</span><span class="decorative-marker">//</span>
					
	                <a class="post-tag post-tag-pandas" href="http://iryndin.net/tags/pandas">pandas</a>,
	                
	                <a class="post-tag post-tag-machine-learning" href="http://iryndin.net/tags/machine-learning">machine learning</a>,
	                
	                <a class="post-tag post-tag-data-science" href="http://iryndin.net/tags/data-science">data science</a>,
	                
				</div>
			

			
				<div class="paging">
					<span class="paging-label">More Reading</span>
					
					<div class="paging-newer">
						<span class="dark-red">Newer</span><span class="decorative-marker">//</span>
						<a class="paging-link" href="/post/useful-ml-articles/">Useful ML articles</a>
		            </div>
		            

					
					<div class="paging-older">
						<span class="dark-red">Older</span><span class="decorative-marker">//</span>
			            <a class="paging-link" href="/post/how-to-standout-as-an-entry-level-data-scientist-candidate/">How to standout as an entry level data scientist candidate</a>
		            </div>
		            
	            </div>
            
          </section>
          
          	
          
        
      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
		</ul>
	</div>

	<p>&copy; 2018. All rights reserved.</p>
</div>
    </div>
  </div>
	

	

  
</body>
</html>
